@{
    ViewData["Title"] = "WeatherPage";
}

<head>
    <link rel="stylesheet" type="text/css" href="/css/weather.css"/>
</head>

<body>
    <section>
        <div class="first-div">
            <div class="get-div">
                <h2>Get Sensor Data</h2>
                <table>
                    <tr id="table-info">
                        <th>Id</th>
                        <th>Device Name</th>
                        <th>Precipitation mm/h</th>
                        <th>Time</th>
                        <th>Latitude</th>
                        <th>Longitude</th>
                        <th>Temperature</th>
                        <th>Atmospheric Pressure (kPa)</th>
                        <th>Max Wind Speed (m/s)</th>
                        <th>Solar Radiation (W/m2)</th>
                        <th>Vapor Pressure (kPa)</th>
                        <th>Humidity (%)</th>
                        <th>Wind Direction (°)</th>
                    </tr>

                    <tbody id="weather-table">

                    </tbody>

                </table>
                <hr />
            </div>

            <div class="second-div">
                <h2>Get max Precipitaion</h2>
                <h3>Device name</h3>
                <input id="device-name-input-2"/>
                <hr />
            </div>

            <div class="post-div">

                <h2>Post new weather sensor</h2>
                <h3>Device name</h3>
                <input id="device-name-input"/>

                <h3>Precipitation</h3>
                <input id="precipitation-input"/>

                <h3>Time</h3>
                <input id="time-input"/>

                <h3>Latitude</h3>
                <input id="latitude-input"/>

                <h3>Longitude</h3>
                <input id="longitude-input"/>

                <h3>Temperature</h3>
                <input id="temperature-input"/>

                <h3>Atmospheric Pressure</h3>
                <input id="atmospheric-pressure-input"/>
                 
                <h3>Max Wind Speed</h3>
                <input id="max-wind-speed"/>

                <h3>Solar Radiation</h3>
                <input id="solar-radiation"/>

                <h3>Vapor Pressure</h3>
                <input id="vapor-pressure"/>

                <h3>Humidity</h3>
                <input id="humidity-input"/>

                <h3>Wind Direction</h3>
                <input id="wind-direction-input"/>

                <button class="add-buttons" id="add-weather">Add single</button>
                <label class="sensor-created" id="sensor-created">Sensor Created</label>
                <button class="add-buttons" id="batch-add-weather">Add manny</button>

                <hr />
            </div>

            <div class="put-div">
                <h2>Put weather</h2>
                <hr />
            </div>

            <div class="delete-div">
                <h2>Delete weather</h2>
                <hr />
            </div class="get-div">
                
            <div class="batch-div">
                <h2>Batch weather</h2>
            </div>
        </div>
    </section>
    <script>
        
        weatherArray = []

        $.ajax({
                type: "GET",
                url: "https://localhost:7033/api/Weather/GetAllSesnors",
                dataType: "JSON",
                success: function (response) {
                    weatherArray = response
                    buildProductTabel(weatherArray)
                    console.log(weatherArray)
                }
        })

        //$.ajax({
        //        type: "GET",
        //        url: "https://localhost:7033/api/Weather/GetMaxPrecipitation?device=Woodford_Sensor",
        //        dataType: "JSON",
        //        success: function (response) {
        //            weatherArray = response
        //            buildProductTabel(weatherArray)
        //            console.log(weatherArray)
        //        }
        //})

        $("#add-weather").click(function (event) {

            var device_name_input = $("#device-name-input").val();
            var precipitation_input = $("#precipitation-input").val();
            var time_input = $("#time-input").val();
            var latitude_input = $("#latitude-input").val();
            var longitude_input = $("#longitude-input").val();
            var temperature_input = $("#temperature-input").val();
            var atmospheric_pressure_input = $("#atmospheric-pressure-input").val();
            var max_wind_speed = $("#max-wind-speed").val();
            var solar_radiation = $("#solar-radiation").val();
            var vapor_pressure = $("#vapor-pressure").val();
            var humidity_input = $("#humidity-input").val();
            var wind_direction_input = $("#wind-direction-input").val();

             var device_name_input_clear = $("#device-name-input").val("");
            var precipitation_input_clear = $("#precipitation-input").val("");
            var time_input_clear = $("#time-input").val("");
            var latitude_input_clear = $("#latitude-input").val("");
            var longitude_input_clear = $("#longitude-input").val("");
            var temperature_input_clear = $("#temperature-input").val("");
            var atmospheric_pressure_input_clear = $("#atmospheric-pressure-input").val("");
            var max_wind_speed_clear = $("#max-wind-speed").val("");
            var solar_radiation_clear = $("#solar-radiation").val("");
            var vapor_pressure_clear = $("#vapor-pressure").val("");
            var humidity_input_clear = $("#humidity-input").val("");
            var wind_direction_input_clear = $("#wind-direction-input").val("");

            var sensor_created = $("#sensor-created");

            $.ajax({
                type: "POST",
                url: 'https://localhost:7033/api/Weather/PostWeatherToWebsite?&'
                + 'Device=' + device_name_input + 
                '&Precipitation_mm_h=' + precipitation_input + 
                '&Time=' + time_input + 
                '&Latitude=' + latitude_input + 
                '&Longitude=' + longitude_input + 
                '&Temperature_C=' + temperature_input + 
                '&AtmosphericPressure_kPa=' + atmospheric_pressure_input +
                '&MaxWindSpeed_ms=' + max_wind_speed +
                '&SolarRadiation_Wm2=' + solar_radiation +
                '&VaporPressure_kPa=' + vapor_pressure +
                '&Humidity_percentage=' + humidity_input +
                '&WindDirection=' + wind_direction_input,
                dataType: "JSON",
                success: function (response) {
                    if (response != null){
                        sensor_created.show()
                        device_name_input_clear
                        precipitation_input_clear
                        time_input_clear
                        latitude_input_clear
                        longitude_input_clear
                        temperature_input_clear
                        atmospheric_pressure_input_clear
                        max_wind_speed_clear
                        solar_radiation_clear
                        vapor_pressure_clear
                        humidity_input_clear
                        wind_direction_input_clear
                        sensor_created.hide()
                    }
                    console.log(response)
                }
            })
        });

        function buildProductTabel(data) {
                var table = document.getElementById('weather-table')
                for (var i = 0; i < data.length; i++) {
                var buttons = `<button>delete</button>`
                    var row = `<tr>
                                   <td>${data[i].id}</td>
                                   <td>${data[i].device}</td>
                                   <td>${data[i].precipitation_mm_h}</td>
                                   <td>${data[i].time}</td>
                                   <td>${data[i].latitude}</td>
                                   <td>${data[i].longitude}</td>
                                   <td>${data[i].temperature_C}</td>
                                   <td>${data[i].atmosphericPressure_kPa}(kPa)</td>
                                   <td>${data[i].maxWindSpeed_ms}(m/s)</td>
                                   <td>${data[i].solarRadiation_Wm2}(W/m2)</td>
                                   <td>${data[i].vaporPressure_kPa}(kPa)</td>
                                   <td>${data[i].humidity_percentage}(%)</td>
                                   <td>${data[i].windDirection}(°)</td>
                                   <td class="td-button">${buttons}</td>
                               </tr>`
                    table.innerHTML += row
                }
        }
    </script>
</body>
